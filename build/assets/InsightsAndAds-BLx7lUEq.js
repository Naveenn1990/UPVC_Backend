import{a as P,u as T,e as b,r as l,j as e,d as t,c as n,b as v}from"./index-BvbRJS_t.js";import{R as u}from"./index-DEuL2NM2.js";import{b as _}from"./index-DWuUjxJc.js";import{B as m}from"./BuyerBottomNav-Bxt6vIKH.js";import{T as M}from"./TopTabBar-BreSykwf.js";const Y=()=>{const{buyerToken:j}=P(),N=T(),h=b(),[f,U]=l.useState([]),[y,E]=l.useState([]),[w,g]=l.useState(!1),[x,R]=l.useState(!1),[B,S]=l.useState(!1),[p,A]=l.useState({}),L=async()=>{try{if(g(!0),h.pathname==="/buyer/insights"){console.log("=== Fetching Buyer Advertisements ==="),console.log("API Base URL:",n("")),console.log("Full API URL:",n("api/buyer/advertisments"));const r=await v.get(n("api/buyer/advertisments"));console.log("Buyer Ads Response:",r),console.log("Buyer Ads Data:",r?.data);let a=[];r?.data&&(Array.isArray(r.data)?a=r.data:r.data.ads&&Array.isArray(r.data.ads)?a=r.data.ads:r.data.data&&Array.isArray(r.data.data)&&(a=r.data.data)),console.log("Total buyer ads found:",a.length),console.log("Ads:",a),a.forEach((i,d)=>{console.log(`Ad ${d+1} URL Construction:`,{id:i._id,title:i.title,type:i.type,originalMediaUrl:i.mediaUrl,resolvedMediaUrl:o(i.mediaUrl),originalThumbnailUrl:i.thumbnailUrl,resolvedThumbnailUrl:i.thumbnailUrl?o(i.thumbnailUrl):null})}),E(a)}else{const r=await v.get(n("api/subcategories"));U(r?.data||[])}}catch(s){R(s.message),console.error("Error fetching data:",s)}finally{g(!1),S(!1)}};l.useEffect(()=>{L()},[h.pathname]);const o=s=>{if(!s)return console.warn("resolveMediaUrl: No URL provided"),null;const r=String(s).trim().replace(/\\/g,"/");if(console.log("resolveMediaUrl - Input:",s),console.log("resolveMediaUrl - Cleaned:",r),/^https?:\/\//i.test(r))return console.log("resolveMediaUrl - Already full URL:",r),r;const a=r.startsWith("/")?r.substring(1):r;if(console.log("resolveMediaUrl - Without leading slash:",a),a.startsWith("uploads/")){const d=n(a);return console.log("resolveMediaUrl - Path has uploads/, Final URL:",d),d}const i=n(`uploads/${a}`);return console.log("resolveMediaUrl - Added uploads/ prefix, Final URL:",i),i},I=async s=>{if(!j){alert("Please login to continue");return}try{N("/buyer/buy-now",{state:{selectedCategory:s}})}catch(r){console.error("Error selecting category:",r)}},c=s=>{A(r=>({...r,[s]:!r[s]}))};return w?e.jsxs("div",{className:"insights-ads-container",children:[e.jsx("div",{className:"loading-container",children:e.jsx("div",{className:"spinner"})}),e.jsx(m,{})]}):x?e.jsxs("div",{className:"insights-ads-container",children:[e.jsx("div",{className:"error-container",children:e.jsxs(t,{className:"error-text",children:["Error loading data: ",x]})}),e.jsx(m,{})]}):e.jsxs("div",{className:"insights-ads-container",children:[e.jsx("div",{className:"insights-ads-header",children:e.jsx("img",{src:"/logo.png",alt:"Logo",className:"insights-logo"})}),e.jsx(M,{}),e.jsx("div",{className:"insights-ads-content",children:h.pathname==="/buyer/insights"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"header-section",children:[e.jsx(t,{weight:"Inter",className:"header-text",children:"INSIGHTS & ADVERTISEMENTS"}),e.jsx(t,{weight:"Inter",className:"sub-header-text",children:"Explore our latest advertisements and insights about uPVC windows. Discover new products, trends, and special offers."})]}),e.jsx("div",{className:"categories-list",children:y.map(s=>e.jsxs("div",{className:"category-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"title-container",children:e.jsx(t,{weight:"Inter",className:"category-title",children:s.title})})}),e.jsx(t,{weight:"Inter",className:"category-description",children:s.description}),e.jsxs("div",{className:"video-container",children:[s.mediaUrl?s.type==="video"?e.jsx(u,{url:o(s.mediaUrl),controls:!0,playing:p[s._id]||!1,width:"100%",height:"100%",onPlay:()=>c(s._id),onPause:()=>c(s._id),onError:r=>{console.error("=== Advertisement Video Load Error ==="),console.error("Ad ID:",s._id),console.error("Ad Title:",s.title),console.error("Original Path:",s.mediaUrl),console.error("Resolved URL:",o(s.mediaUrl)),console.error("Error:",r),console.error("=====================================")},onReady:()=>{console.log("✓ Advertisement video ready:",{id:s._id,title:s.title,url:o(s.mediaUrl)})},config:{file:{attributes:{controlsList:"nodownload",preload:"metadata"}}}}):e.jsx("img",{src:o(s.mediaUrl),alt:s.title,className:"ad-image",style:{width:"100%",height:"100%",objectFit:"cover"},onError:r=>{console.error("Image failed to load:",{originalUrl:s.mediaUrl,resolvedUrl:o(s.mediaUrl)}),r.target.style.display="none"}}):e.jsx("div",{className:"no-video",children:e.jsx("p",{children:"No media available"})}),e.jsx("div",{className:"video-overlay"})]}),s.sponsorText&&e.jsx("div",{className:"sponsor-container",children:e.jsxs("div",{className:"sponsor-content",children:[s.sponsorLogo?e.jsx("img",{src:o(s.sponsorLogo),alt:"Sponsor",className:"sponsor-logo"}):e.jsx("img",{src:"/logo.png",alt:"Logo",className:"sponsor-logo"}),e.jsxs(t,{weight:"Inter",className:"sponsor-text",children:["SPONSORED BY ",s.sponsorText.toUpperCase()]})]})})]},s._id))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"header-section",children:[e.jsx(t,{weight:"Inter",className:"header-text",children:"SELECT YOUR PREFERRED CATEGORY"}),e.jsx(t,{weight:"Inter",className:"sub-header-text",children:"We've categorized uPVC windows into 3 tiers to match your style & requirements. Please select one category to explore the premium brands we offer."})]}),e.jsx("div",{className:"categories-list",children:f.map(s=>e.jsxs("div",{className:"category-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("div",{className:"title-container",children:e.jsx(t,{weight:"Inter",className:"category-title",children:s.name})}),e.jsxs("button",{className:"select-button",onClick:()=>I(s),children:[e.jsx(t,{weight:"Inter",className:"select-button-text",children:"SELECT"}),e.jsx(_,{size:18,color:"#fff"})]})]}),e.jsx(t,{weight:"Inter",className:"category-description",children:s.description}),e.jsxs("div",{className:"video-container",children:[s.videoUrl?e.jsx(u,{url:o(s.videoUrl),controls:!0,playing:p[s._id]||!1,width:"100%",height:"100%",onPlay:()=>c(s._id),onPause:()=>c(s._id),onError:r=>{console.error("=== Subcategory Video Load Error ==="),console.error("Subcategory ID:",s._id),console.error("Subcategory Name:",s.name),console.error("Original Path:",s.videoUrl),console.error("Resolved URL:",o(s.videoUrl)),console.error("Error:",r),console.error("====================================")},onReady:()=>{console.log("✓ Subcategory video ready:",{id:s._id,name:s.name,url:o(s.videoUrl)})},config:{file:{attributes:{controlsList:"nodownload",preload:"metadata"}}}}):e.jsx("div",{className:"no-video",children:e.jsx("p",{children:"No video available"})}),e.jsx("div",{className:"video-overlay"})]}),e.jsx("div",{className:"sponsor-container",children:e.jsxs("div",{className:"sponsor-content",children:[s.sponsorLogo?e.jsx("img",{src:o(s.sponsorLogo),alt:"Sponsor",className:"sponsor-logo"}):e.jsx("img",{src:"/logo.png",alt:"Logo",className:"sponsor-logo"}),e.jsxs(t,{weight:"Inter",className:"sponsor-text",children:["SPONSORED BY"," ",s?.sponsorText?.toUpperCase()||"ELITE CREST"]})]})})]},s._id))})]})}),e.jsx(m,{})]})};export{Y as default};
