import{a as L,u as R,r as o,b,A as y,c as w,j as e,d as t}from"./index-BvbRJS_t.js";import{R as $}from"./index-DEuL2NM2.js";import{z as F,A as O,B as D,C as U}from"./index-DWuUjxJc.js";import{S as T}from"./SellerBottomNav-Pmzavrfs.js";const _=()=>{const{sellerToken:r,logout:M}=L(),P=R(),[c,i]=o.useState(!1),[x,n]=o.useState(null),[u,p]=o.useState(!1),[g,m]=o.useState(0),[S,h]=o.useState(!0),[f,V]=o.useState(!0),[v,d]=o.useState(!1),j=o.useRef(null);o.useEffect(()=>{I()},[]);const I=async()=>{try{if(h(!0),!r){h(!1);return}const s=await b.get(`${y}/api/sellers`,{headers:{Authorization:`Bearer ${r}`}});if(s.data.success&&s.data.seller){const l=s.data.seller.status;if(l!=="approved"){console.log("Seller status is not approved:",l),P("/seller/pending-approval");return}s.data.seller.businessProfileVideo?(i(!0),n(w(s.data.seller.businessProfileVideo))):(i(!1),n(null))}}catch(s){console.error("Error checking existing video:",s),i(!1),n(null)}finally{h(!1)}},z=s=>{const l=s.target.files[0];l&&k(l)},k=async s=>{try{if(!s.type.startsWith("video/")){alert("Please select a video file");return}const l=s.size/(1024*1024);if(l>200){alert(`Video file is ${l.toFixed(2)}MB. Maximum allowed size is 200MB.`);return}const a=document.createElement("video");a.preload="metadata",a.onloadedmetadata=async function(){if(window.URL.revokeObjectURL(a.src),a.duration>45){alert("Video must be 45 seconds or less");return}await B(s)},a.src=URL.createObjectURL(s)}catch(l){console.error("Error in handleUpload:",l),alert("Failed to process video")}},B=async s=>{try{if(p(!0),m(0),!r){alert("Please login"),p(!1);return}const l=new FormData;l.append("businessProfileVideo",s);const a=await b.post(`${y}/api/sellers/business-video`,l,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"multipart/form-data"},onUploadProgress:N=>{const A=Math.round(N.loaded*100/N.total);m(A)}});if(a.data.success)i(!0),n(w(a.data.videoUrl)),alert("Video uploaded successfully!");else throw new Error(a.data.message||"Failed to upload video")}catch(l){console.error("Error uploading video:",l),alert(l.response?.data?.message||"Failed to upload video")}finally{p(!1),m(0)}},C=()=>{j.current?.click()},E=()=>{V(!f)};return S?e.jsx("div",{className:"seller-dashboard-container",children:e.jsxs("div",{className:"seller-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx(t,{children:"Loading..."})]})}):e.jsxs("div",{className:"seller-dashboard-container",children:[e.jsxs("div",{className:"seller-dashboard-header",children:[e.jsx("img",{src:"/logo.png",alt:"Logo",className:"seller-logo"}),e.jsx("button",{className:"seller-logout-button",onClick:M,children:"Logout"})]}),e.jsxs("div",{className:"seller-dashboard-content",children:[e.jsxs("div",{className:"seller-welcome-section",children:[e.jsx(t,{weight:"Inter",className:"seller-welcome-title",children:"Welcome to Your Business Profile"}),e.jsx(t,{weight:"Inter",className:"seller-welcome-subtitle",children:c?"Your business profile video is live! You can update it anytime.":"Upload a video to showcase your business to potential buyers"})]}),e.jsx("div",{className:"seller-video-section",children:c&&x?e.jsxs("div",{className:"seller-video-container",children:[e.jsx("div",{className:"seller-video-player",children:e.jsx($,{url:x,controls:!0,playing:v,muted:f,width:"100%",height:"100%",onPlay:()=>d(!0),onPause:()=>d(!1),onEnded:()=>d(!1)})}),e.jsxs("div",{className:"seller-video-controls",children:[e.jsx("button",{className:"seller-control-button",onClick:E,children:f?e.jsx(F,{size:24}):e.jsx(O,{size:24})}),e.jsx("button",{className:"seller-control-button",onClick:()=>d(!v),children:e.jsx(D,{size:24})})]})]}):e.jsxs("div",{className:"seller-upload-placeholder",children:[e.jsx(U,{size:64,color:"#ccc"}),e.jsx(t,{weight:"Inter",className:"seller-upload-text",children:"No video uploaded yet"})]})}),e.jsxs("div",{className:"seller-upload-section",children:[e.jsx("input",{ref:j,type:"file",accept:"video/*",onChange:z,style:{display:"none"}}),e.jsxs("button",{className:"seller-upload-button",onClick:C,disabled:u,children:[e.jsx(U,{size:24}),e.jsx(t,{weight:"Inter",className:"seller-upload-button-text",children:u?`Uploading... ${g}%`:c?"Update Video":"Upload Video"})]}),u&&e.jsx("div",{className:"seller-progress-bar",children:e.jsx("div",{className:"seller-progress-fill",style:{width:`${g}%`}})}),e.jsxs("div",{className:"seller-upload-info",children:[e.jsx(t,{weight:"Inter",className:"seller-info-text",children:"• Maximum duration: 45 seconds"}),e.jsx(t,{weight:"Inter",className:"seller-info-text",children:"• Maximum file size: 200MB"}),e.jsx(t,{weight:"Inter",className:"seller-info-text",children:"• Supported formats: MP4, WebM, OGG"})]})]})]}),e.jsx(T,{})]})};export{_ as default};
